{"version":3,"file":"SdkTypeScriptDiagnosticsExtractor.js","names":["getStrictDiagnostics","builderProgram","fileName","cancellationToken","_this","strict","getAllDiagnostics","filter","diag","_newArrowCheck","length","start","bind","nonStrict","nonStrictHashes","reduce","result","value","hash","hashDiagnostic","add","Set","has","isStrict","_this2","sourceFile","getSourceFile","syntacticDiagnostics","getSyntacticDiagnostics","builderProgramForLinter","getSemanticDiagnostics","concat","file","diagnostic","undefined","code"],"sources":["../../../sdk/linter_1_1/SdkTypeScriptDiagnosticsExtractor.ts"],"sourcesContent":["/*\n * Copyright (c) 2023-2024 Huawei Device Co., Ltd.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as ts from 'typescript';\n\n/**\n * Returns diagnostics which appear in strict compilation mode only\n */\nexport function getStrictDiagnostics(\n  builderProgram: ts.BuilderProgram,\n  fileName: string,\n  cancellationToken?: ts.CancellationToken\n): ts.Diagnostic[] {\n  // applying filter is a workaround for tsc bug\n  const strict = getAllDiagnostics(builderProgram, fileName, cancellationToken, true).filter((diag) => {\n    return !(diag.length === 0 && diag.start === 0);\n  });\n  const nonStrict = getAllDiagnostics(builderProgram, fileName, cancellationToken, false);\n\n  // collect hashes for later easier comparison\n  const nonStrictHashes = nonStrict.reduce((result, value) => {\n    const hash = hashDiagnostic(value);\n    if (hash) {\n      result.add(hash);\n    }\n    return result;\n  }, new Set<string>());\n  // return diagnostics which weren't detected in non-strict mode\n  return strict.filter((value) => {\n    const hash = hashDiagnostic(value);\n    return hash && !nonStrictHashes.has(hash);\n  });\n}\n\nfunction getAllDiagnostics(\n  builderProgram: ts.BuilderProgram,\n  fileName: string,\n  cancellationToken?: ts.CancellationToken,\n  isStrict: boolean = false\n): ts.Diagnostic[] {\n  const sourceFile = builderProgram.getSourceFile(fileName);\n  const syntacticDiagnostics: readonly ts.Diagnostic[] = builderProgram.getSyntacticDiagnostics(\n    sourceFile,\n    cancellationToken\n  );\n  if (isStrict) {\n    return !builderProgram.builderProgramForLinter ?\n      [] :\n      builderProgram.builderProgramForLinter.\n        getSemanticDiagnostics(sourceFile, cancellationToken).\n        concat(syntacticDiagnostics).\n        filter((diag) => {\n          return diag.file === sourceFile;\n        });\n  }\n  return builderProgram.\n    getSemanticDiagnostics(sourceFile, cancellationToken).\n    concat(syntacticDiagnostics).\n    filter((diag) => {\n      return diag.file === sourceFile;\n    });\n}\n\nfunction hashDiagnostic(diagnostic: ts.Diagnostic): string | undefined {\n  if (diagnostic.start === undefined || diagnostic.length === undefined) {\n    return undefined;\n  }\n  return `${diagnostic.code}%${diagnostic.start}%${diagnostic.length}`;\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA;AACA;AACA;AACO,SAASA,oBAAoBA,CAClCC,cAAiC,EACjCC,QAAgB,EAChBC,iBAAwC,EACvB;EAAA,IAAAC,KAAA;EACjB;EACA,MAAMC,MAAM,GAAGC,iBAAiB,CAACL,cAAc,EAAEC,QAAQ,EAAEC,iBAAiB,EAAE,IAAI,CAAC,CAACI,MAAM,CAAC,UAACC,IAAI,EAAK;IAAAC,cAAA,OAAAL,KAAA;IACnG,OAAO,EAAEI,IAAI,CAACE,MAAM,KAAK,CAAC,IAAIF,IAAI,CAACG,KAAK,KAAK,CAAC,CAAC;EACjD,CAAC,CAAAC,IAAA,OAAC;EACF,MAAMC,SAAS,GAAGP,iBAAiB,CAACL,cAAc,EAAEC,QAAQ,EAAEC,iBAAiB,EAAE,KAAK,CAAC;;EAEvF;EACA,MAAMW,eAAe,GAAGD,SAAS,CAACE,MAAM,CAAC,UAACC,MAAM,EAAEC,KAAK,EAAK;IAAAR,cAAA,OAAAL,KAAA;IAC1D,MAAMc,IAAI,GAAGC,cAAc,CAACF,KAAK,CAAC;IAClC,IAAIC,IAAI,EAAE;MACRF,MAAM,CAACI,GAAG,CAACF,IAAI,CAAC;IAClB;IACA,OAAOF,MAAM;EACf,CAAC,CAAAJ,IAAA,QAAE,IAAIS,GAAG,CAAS,CAAC,CAAC;EACrB;EACA,OAAOhB,MAAM,CAACE,MAAM,CAAC,UAACU,KAAK,EAAK;IAAAR,cAAA,OAAAL,KAAA;IAC9B,MAAMc,IAAI,GAAGC,cAAc,CAACF,KAAK,CAAC;IAClC,OAAOC,IAAI,IAAI,CAACJ,eAAe,CAACQ,GAAG,CAACJ,IAAI,CAAC;EAC3C,CAAC,CAAAN,IAAA,OAAC;AACJ;AAEA,SAASN,iBAAiBA,CACxBL,cAAiC,EACjCC,QAAgB,EAChBC,iBAAwC,EACxCoB,QAAiB,GAAG,KAAK,EACR;EAAA,IAAAC,MAAA;EACjB,MAAMC,UAAU,GAAGxB,cAAc,CAACyB,aAAa,CAACxB,QAAQ,CAAC;EACzD,MAAMyB,oBAA8C,GAAG1B,cAAc,CAAC2B,uBAAuB,CAC3FH,UAAU,EACVtB,iBACF,CAAC;EACD,IAAIoB,QAAQ,EAAE;IACZ,OAAO,CAACtB,cAAc,CAAC4B,uBAAuB,GAC5C,EAAE,GACF5B,cAAc,CAAC4B,uBAAuB,CACpCC,sBAAsB,CAACL,UAAU,EAAEtB,iBAAiB,CAAC,CACrD4B,MAAM,CAACJ,oBAAoB,CAAC,CAC5BpB,MAAM,CAAC,UAACC,IAAI,EAAK;MAAAC,cAAA,OAAAe,MAAA;MACf,OAAOhB,IAAI,CAACwB,IAAI,KAAKP,UAAU;IACjC,CAAC,CAAAb,IAAA,OAAC;EACR;EACA,OAAOX,cAAc,CACnB6B,sBAAsB,CAACL,UAAU,EAAEtB,iBAAiB,CAAC,CACrD4B,MAAM,CAACJ,oBAAoB,CAAC,CAC5BpB,MAAM,CAAC,UAACC,IAAI,EAAK;IAAAC,cAAA,OAAAe,MAAA;IACf,OAAOhB,IAAI,CAACwB,IAAI,KAAKP,UAAU;EACjC,CAAC,CAAAb,IAAA,OAAC;AACN;AAEA,SAASO,cAAcA,CAACc,UAAyB,EAAsB;EACrE,IAAIA,UAAU,CAACtB,KAAK,KAAKuB,SAAS,IAAID,UAAU,CAACvB,MAAM,KAAKwB,SAAS,EAAE;IACrE,OAAOA,SAAS;EAClB;EACA,OAAO,GAAGD,UAAU,CAACE,IAAI,IAAIF,UAAU,CAACtB,KAAK,IAAIsB,UAAU,CAACvB,MAAM,EAAE;AACtE","ignoreList":[]}