{"version":3,"file":"TypeScriptDiagnosticsExtractor.js","names":["getStrictDiagnostics","strictProgram","nonStrictProgram","fileName","cancellationToken","_this","strict","getAllDiagnostics","filter","diag","_newArrowCheck","length","start","bind","nonStrict","nonStrictHashes","reduce","result","value","hash","hashDiagnostic","add","Set","has","program","_this2","sourceFile","getSourceFile","getSemanticDiagnostics","concat","getSyntacticDiagnostics","file","diagnostic","undefined","code"],"sources":["../../../lib/ts-diagnostics/TypeScriptDiagnosticsExtractor.ts"],"sourcesContent":["/*\n * Copyright (c) 2023-2024 Huawei Device Co., Ltd.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as ts from 'typescript';\n\n/**\n * Returns diagnostics which appear in strict compilation mode only\n */\nexport function getStrictDiagnostics(\n  strictProgram: ts.Program,\n  nonStrictProgram: ts.Program,\n  fileName: string,\n  cancellationToken?: ts.CancellationToken\n): ts.Diagnostic[] {\n  // applying filter is a workaround for tsc bug\n  const strict = getAllDiagnostics(strictProgram, fileName, cancellationToken).filter((diag) => {\n    return !(diag.length === 0 && diag.start === 0);\n  });\n  const nonStrict = getAllDiagnostics(nonStrictProgram, fileName, cancellationToken);\n\n  // collect hashes for later easier comparison\n  const nonStrictHashes = nonStrict.reduce((result, value) => {\n    const hash = hashDiagnostic(value);\n    if (hash) {\n      result.add(hash);\n    }\n    return result;\n  }, new Set<string>());\n  // return diagnostics which weren't detected in non-strict mode\n  return strict.filter((value) => {\n    const hash = hashDiagnostic(value);\n    return hash && !nonStrictHashes.has(hash);\n  });\n}\n\nfunction getAllDiagnostics(\n  program: ts.Program,\n  fileName: string,\n  cancellationToken?: ts.CancellationToken\n): ts.Diagnostic[] {\n  const sourceFile = program.getSourceFile(fileName);\n  return program.\n    getSemanticDiagnostics(sourceFile, cancellationToken).\n    concat(program.getSyntacticDiagnostics(sourceFile, cancellationToken)).\n    filter((diag) => {\n      return diag.file === sourceFile;\n    });\n}\n\nfunction hashDiagnostic(diagnostic: ts.Diagnostic): string | undefined {\n  if (diagnostic.start === undefined || diagnostic.length === undefined) {\n    return undefined;\n  }\n  return `${diagnostic.code}%${diagnostic.start}%${diagnostic.length}`;\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA;AACA;AACA;AACO,SAASA,oBAAoBA,CAClCC,aAAyB,EACzBC,gBAA4B,EAC5BC,QAAgB,EAChBC,iBAAwC,EACvB;EAAA,IAAAC,KAAA;EACjB;EACA,MAAMC,MAAM,GAAGC,iBAAiB,CAACN,aAAa,EAAEE,QAAQ,EAAEC,iBAAiB,CAAC,CAACI,MAAM,CAAC,UAACC,IAAI,EAAK;IAAAC,cAAA,OAAAL,KAAA;IAC5F,OAAO,EAAEI,IAAI,CAACE,MAAM,KAAK,CAAC,IAAIF,IAAI,CAACG,KAAK,KAAK,CAAC,CAAC;EACjD,CAAC,CAAAC,IAAA,OAAC;EACF,MAAMC,SAAS,GAAGP,iBAAiB,CAACL,gBAAgB,EAAEC,QAAQ,EAAEC,iBAAiB,CAAC;;EAElF;EACA,MAAMW,eAAe,GAAGD,SAAS,CAACE,MAAM,CAAC,UAACC,MAAM,EAAEC,KAAK,EAAK;IAAAR,cAAA,OAAAL,KAAA;IAC1D,MAAMc,IAAI,GAAGC,cAAc,CAACF,KAAK,CAAC;IAClC,IAAIC,IAAI,EAAE;MACRF,MAAM,CAACI,GAAG,CAACF,IAAI,CAAC;IAClB;IACA,OAAOF,MAAM;EACf,CAAC,CAAAJ,IAAA,QAAE,IAAIS,GAAG,CAAS,CAAC,CAAC;EACrB;EACA,OAAOhB,MAAM,CAACE,MAAM,CAAC,UAACU,KAAK,EAAK;IAAAR,cAAA,OAAAL,KAAA;IAC9B,MAAMc,IAAI,GAAGC,cAAc,CAACF,KAAK,CAAC;IAClC,OAAOC,IAAI,IAAI,CAACJ,eAAe,CAACQ,GAAG,CAACJ,IAAI,CAAC;EAC3C,CAAC,CAAAN,IAAA,OAAC;AACJ;AAEA,SAASN,iBAAiBA,CACxBiB,OAAmB,EACnBrB,QAAgB,EAChBC,iBAAwC,EACvB;EAAA,IAAAqB,MAAA;EACjB,MAAMC,UAAU,GAAGF,OAAO,CAACG,aAAa,CAACxB,QAAQ,CAAC;EAClD,OAAOqB,OAAO,CACZI,sBAAsB,CAACF,UAAU,EAAEtB,iBAAiB,CAAC,CACrDyB,MAAM,CAACL,OAAO,CAACM,uBAAuB,CAACJ,UAAU,EAAEtB,iBAAiB,CAAC,CAAC,CACtEI,MAAM,CAAC,UAACC,IAAI,EAAK;IAAAC,cAAA,OAAAe,MAAA;IACf,OAAOhB,IAAI,CAACsB,IAAI,KAAKL,UAAU;EACjC,CAAC,CAAAb,IAAA,OAAC;AACN;AAEA,SAASO,cAAcA,CAACY,UAAyB,EAAsB;EACrE,IAAIA,UAAU,CAACpB,KAAK,KAAKqB,SAAS,IAAID,UAAU,CAACrB,MAAM,KAAKsB,SAAS,EAAE;IACrE,OAAOA,SAAS;EAClB;EACA,OAAO,GAAGD,UAAU,CAACE,IAAI,IAAIF,UAAU,CAACpB,KAAK,IAAIoB,UAAU,CAACrB,MAAM,EAAE;AACtE","ignoreList":[]}